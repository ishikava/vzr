"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}var LanguageConverter=function(){function n(e){_classCallCheck(this,n),this.config=e,this.inputs=$(".js-language-convert"),this.languagesList=["eng","rus"],this.listenConverter()}return _createClass(n,[{key:"getLanguageTransform",value:function(e,n){switch(e){case"eng":return this.convertStringToEnglish(n);case"rus":default:return this.convertStringToRussian(n)}}},{key:"getRussianAlphabet",value:function(){return new Array('"',"й","ц","у","к","е","н","г","ш","щ","з","х","ъ","ф","ы","в","а","п","р","о","л","д","ж","э","я","ч","с","м","и","т","ь","б","ю","Й","Ц","У","К","Е","Н","Г","Ш","Щ","З","Х","Ъ","Ф","Ы","В","А","П","Р","О","Л","Д","Ж","Э","Я","Ч","С","М","И","Т","Ь","Б","Ю")}},{key:"getEnglishAlphabet",value:function(){return new Array("@","q","w","e","r","t","y","u","i","o","p","[","]","a","s","d","f","g","h","j","k","l",";","'","z","x","c","v","b","n","m",",",".","Q","W","E","R","T","Y","U","I","O","P","{","}","A","S","D","F","G","H","J","K","L",":",'"',"Z","X","C","V","B","N","M","<",">")}},{key:"convertStringToRussian",value:function(e){var n=this.getEnglishAlphabet(),t=this.getRussianAlphabet();return this._stringReplace(n,t,e)}},{key:"convertStringToEnglish",value:function(e){var n=this.getEnglishAlphabet(),t=this.getRussianAlphabet();return this._stringReplace(t,n,e)}},{key:"listenConverter",value:function(){var r=this;r.inputs.on("keyup.lang",function(e){var n=$(e.currentTarget),t=n.data("output-language");if(!r._checkLanguageConfiguration(t))return!0;e=n.val(),t=r.getLanguageTransform(t,e);e!==t&&(n.val(t),r._setCaretToCorrectPosition(n,e,t)),n.off("focusout.trigger"),n.one("focusout.trigger",function(){n.trigger("change")})}),r.inputs.on("paste",function(e){var t=$(e.currentTarget);setTimeout(function(){var e=t.val(),n=t.data("output-language"),n=r.getLanguageTransform(n,e);e!==n&&(t.val(n),r._setCaretToCorrectPosition(this,e,n)),t.off("focusout.trigger"),t.one("focusout.trigger",function(){t.trigger("change")})},100)})}},{key:"_stringReplace",value:function(e,n,t){if(!(n instanceof Array)&&(n=new Array(n),e instanceof Array))for(;e.length>n.length;)n[n.length]=n[0];for(e instanceof Array||(e=new Array(e));e.length>n.length;)n[n.length]="";if(t instanceof Array){for(var r in t)t[r]=this._stringReplace(e,n,t[r]);return t}for(var a=0;a<e.length;a++)for(var i=t.indexOf(e[a]);-1<i;)i=(t=t.replace(e[a],n[a])).indexOf(e[a],i);return t}},{key:"_checkLanguageConfiguration",value:function(e){return void 0===e?(console.warn("There is no defined language configuration"),!1):!(this.languagesList.indexOf(e)<0)||(console.warn("Wrong language configuration! Now it is "+e),!1)}},{key:"_setCaretToCorrectPosition",value:function(e,n,t){for(var r=0;r<t.length;r++){var a=t.length-r-1,i=n.length-r-1;if(t[a]!==n[i]){this._setCaretToPosition(e,1+a);break}}}},{key:"_setSelectionRange",value:function(e,n,t){e.setSelectionRange?(e.focus(),e.setSelectionRange(n,t)):e.createTextRange&&((e=e.createTextRange()).collapse(!0),e.moveEnd("character",t),e.moveStart("character",n),e.select())}},{key:"_setCaretToPosition",value:function(e,n){this._setSelectionRange(e,n,n)}}]),n}();window.initLanguageConverter=function(){new LanguageConverter},$(function(){window.initLanguageConverter()});